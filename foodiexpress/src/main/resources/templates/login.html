<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>FoodExpress - Login</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet">
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet">

    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet">

    <style>
          body {
            font-family: 'Poppins', sans-serif;
            background-color: #F0E3CA;
            color: black;
            position: relative;
            min-height: 90vh;
          }
          .bg-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://images.unsplash.com/photo-1504674900247-0877df9cc836?q=80&w=1470&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
            opacity: 0.4;
            z-index: 0;
          }
          .login-container {
            background-color:rgb(202, 169, 135);
            border-radius: 15px;
            padding: 30px;
            z-index: 1;
            position: relative;
          }
          .btn-black {
            background-color: black;
            color: white;
            font-weight: 600;
          }
          .btn-black:hover {
            background-color: #333;
            color: white;
          }
          label, input, select, a, p, h1, h2 {
            font-family: 'Poppins', sans-serif;
          }
        </style>
  </head>

  <body>

    <div class="bg-overlay"></div>

    <div
      class="container d-flex align-items-center justify-content-center min-vh-100">
      <div class="col-md-5 col-lg-5">
        <div class="text-center mb-4">
          <h1 class="fw-bold" style="color: #ff5b03;">Foodie Express</h1>
          <p>Delicious food at your doorstep</p>
        </div>

        <div class="login-container shadow-lg">
          <h2 class="text-center fw-bold mb-4">Login to Your Account</h2>

          <div th:if="${param.error}" class="alert alert-danger text-center"
            role="alert">
            Invalid username or password.
          </div>
          <div th:if="${param.logout}" class="alert alert-success text-center"
            role="alert">
            You have been logged out.
          </div>
          <div th:if="${param.registered}" class="alert alert-success text-center"
            role="alert">
            Registration successful! Please log in.
          </div>

          <form th:action="@{/showLogin}" method="POST" novalidate
            class="needs-validation">

            <div class="mb-3">
              <label for="email" class="form-label fw-medium">Email Address</label>
              <div class="input-group">
                <span class="input-group-text bg-white border-0">
                  <i class="bi bi-envelope-fill text-muted"></i>
                </span>
                <input
                  type="email" class="form-control py-3 rounded-end"
                  id="email"
                  placeholder="Enter your email"
                  name="username" required />
                <div class="invalid-feedback">
                  Please enter a valid email address.
                </div>
              </div>
            </div>

            <div class="mb-3">
              <label for="password" class="form-label fw-medium">Password</label>
              <div class="input-group">
                <span class="input-group-text bg-white border-0">
                  <i class="bi bi-lock-fill text-muted"></i>
                </span>
                <input
                  type="password"
                  class="form-control py-3 rounded-end"
                  id="password"
                  name="password" placeholder="Enter your password"
                  required
                  minlength="6" /> <div class="invalid-feedback">
                  Please enter your password (minimum 6 characters).
                </div>
              </div>
            </div>

            <div class="d-grid mb-3">
              <button type="submit" class="btn btn-black">Login</button>
            </div>

            <div class="d-flex align-items-center my-3">
              <hr class="flex-grow-1 border-black">
              <span class="px-2">OR</span>
              <hr class="flex-grow-1 border-black">
            </div>

            </form>
          <div class="text-center">
            <p>Don't have an account? <a th:href="@{/showRegister}"
                class="text-black text-decoration-underline fw-medium">Sign
                up</a></p>
          </div>
        </div>

      </div>
    </div>
    <br>
    <br>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // This script forces a page reload on back/forward navigation.
      // It helps prevent cached form states, especially after logout/login.
      window.addEventListener('pageshow' , function (event) {
        if(event.persisted || (window.performance && window.performance.navigation.type === 2)){
          window.location.reload();
        }
      });

      // Bootstrap's custom form validation script.
      // It iterates through all forms with the 'needs-validation' class.
      // On submission, it checks validity and applies Bootstrap's validation styles.
      (function () {
        'use strict' // Enforces stricter parsing and error handling

        // Fetch all forms that need custom validation
        var forms = document.querySelectorAll('.needs-validation')

        // Loop over them and prevent submission if invalid
        Array.prototype.slice.call(forms) // Convert NodeList to Array for forEach
          .forEach(function (form) {
            form.addEventListener('submit', function (event) {
              // Check if the form is valid according to HTML5 constraints
              if (!form.checkValidity()) {
                event.preventDefault() // Stop form submission
                event.stopPropagation() // Stop event bubbling
              }

              // Add 'was-validated' class to trigger Bootstrap's validation styles
              form.classList.add('was-validated')
            }, false) // Use 'false' for useCapture parameter (event bubbling)
          })
      })()
    </script>
  </body>
</html>